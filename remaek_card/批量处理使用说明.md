# 卡牌批量处理使用说明

## 功能概述

本工具支持两种处理模式：
1. **单个文件夹处理** - 处理指定的单个文件夹
2. **批量处理** - 自动按顺序处理01-54所有文件夹

## 支持的文件夹列表

| 代码 | 文件夹名称 | 说明 |
|------|------------|------|
| 01 | 01_基础游戏 | 基础游戏卡牌 |
| 02 | 02_敦威治遗产 | 敦威治遗产扩展 |
| 03 | 03_卡尔克萨之路 | 卡尔克萨之路扩展 |
| 04 | 04_失落的时代 | 失落的时代扩展 |
| 05 | 05_万象无终 | 万象无终扩展 |
| 06 | 06_食梦者 | 食梦者扩展 |
| 07 | 07_印斯茅斯的阴谋 | 印斯茅斯的阴谋扩展 |
| 08 | 08_暗与地球之界 | 暗与地球之界扩展 |
| 09 | 09_绯红密钥 | 绯红密钥扩展 |
| 10 | 10_铁杉谷盛宴 | 铁杉谷盛宴扩展 |
| 50 | 50_重返基础 | 重返基础扩展 |
| 51 | 51_重返敦威治遗产 | 重返敦威治遗产扩展 |
| 52 | 52_重返卡尔克萨之路 | 重返卡尔克萨之路扩展 |
| 53 | 53_重返失落的时代 | 重返失落的时代扩展 |
| 54 | 54_重返万象无终 | 重返万象无终扩展 |

## 使用方法

### 1. 单个文件夹处理

```bash
python main.py
```

这将处理默认的文件夹：`D:\诡镇奇谈\重置玩家卡\01_基础游戏`

如需处理其他文件夹，请修改代码中的路径：
```python
scanner = CardMetadataScanner(
    work_directory=r"D:\诡镇奇谈\重置玩家卡\02_敦威治遗产",  # 修改这里
    code="02"  # 修改对应的代码
)
```

### 2. 批量处理所有文件夹

#### 基本用法
```bash
python main.py batch
```
默认处理：`D:\诡镇奇谈\重置玩家卡` 下的所有文件夹

#### 指定文件夹类型
```bash
python main.py batch 重置玩家卡
python main.py batch 重置剧本卡
```

#### 指定完整路径
```bash
python main.py batch 重置玩家卡 "D:\诡镇奇谈"
python main.py batch 重置剧本卡 "E:\游戏\诡镇奇谈"
```

## 目录结构要求

工具期望的目录结构：
```
基础目录/
├── 重置玩家卡/          # 或 重置剧本卡/
│   ├── 01_基础游戏/
│   │   ├── 图片/        # 包含卡牌图片文件
│   │   └── 卡牌/        # 输出目录（自动创建）
│   ├── 02_敦威治遗产/
│   │   ├── 图片/
│   │   └── 卡牌/
│   └── ...
├── db_cards_en.json     # 卡牌数据库
└── translation_data.json # 翻译数据（可选）
```

## 输出文件

### 每个文件夹会生成：
- `card_metadata.json` - 卡牌元数据
- `卡牌/` 目录 - 包含转换后的 `.card` 文件

### 批量处理会额外生成：
- `batch_processing_results_重置玩家卡.json` - 处理结果报告
- `batch_processing_results_重置剧本卡.json` - 处理结果报告

## 处理结果报告

批量处理完成后会生成详细的JSON报告，包含：
- 处理统计信息
- 每个文件夹的处理状态
- 成功/失败的详细信息
- 处理的卡牌数量统计

## 错误处理

工具具有完善的错误处理机制：
- 目录不存在时会跳过并记录
- 单个文件夹处理失败不会影响其他文件夹
- 详细的错误信息会显示在控制台和报告中

## 注意事项

1. **确保路径正确**：检查基础目录和文件夹类型是否正确
2. **权限问题**：确保程序有读写权限
3. **文件格式**：图片文件支持 jpg, jpeg, png, gif, bmp, webp 格式
4. **命名规则**：图片文件名应包含位置数字，背面文件以 'b' 结尾
5. **数据库文件**：确保 `db_cards_en.json` 存在且格式正确

## 示例输出

```
================================================================================
开始批量处理所有文件夹
基础目录: D:\诡镇奇谈
文件夹类型: 重置玩家卡
总共需要处理: 15 个文件夹
================================================================================

[1/15] 正在处理: 01_基础游戏 (代码: 01)
路径: D:\诡镇奇谈\重置玩家卡\01_基础游戏
------------------------------------------------------------
开始扫描工作目录: D:\诡镇奇谈\重置玩家卡\01_基础游戏
项目代码: 01 (匹配卡牌code的前2位)
...
统计信息: 正面 25 张, 背面 25 张, 总计 50 张
✅ 01_基础游戏 处理完成 - 共 50 张卡牌

...

================================================================================
批量处理完成!
================================================================================
成功处理: 12 个文件夹
处理失败: 3 个文件夹
总计处理卡牌: 850 张
处理结果已保存到: D:\诡镇奇谈\batch_processing_results_重置玩家卡.json
```

## 故障排除

### 常见问题

1. **"工作目录不存在"错误**
   - 检查路径是否正确
   - 确保文件夹存在

2. **"图片目录不存在"错误**
   - 检查文件夹下是否有 `图片` 目录
   - 确保图片文件存在

3. **"未找到位置对应的卡牌数据"警告**
   - 检查图片文件名是否包含正确的位置数字
   - 确认 `db_cards_en.json` 包含对应的数据

4. **翻译数据未生效**
   - 确保 `translation_data.json` 存在
   - 检查翻译数据的 code 字段是否匹配

### 调试建议

1. 先用单个文件夹测试，确认配置正确
2. 检查控制台输出的详细错误信息
3. 查看生成的处理结果报告
4. 确认所有依赖文件存在且格式正确

## 技术支持

如遇到问题，请检查：
1. Python 环境（建议 3.7+）
2. 依赖包是否安装（PIL, json, os, re, pathlib）
3. 文件权限设置
4. 磁盘空间是否充足
