# 配置管理相关接口

## 15. 获取配置项

### 基本信息

- **接口名称**: 获取配置项
- **请求地址**: `/api/config`
- **请求方法**: `GET`
- **功能描述**: 获取工作目录下config.json的配置内容

### 请求参数

无需传入参数

### 响应格式

| 字段        | 类型   | 说明       |
| ----------- | ------ | ---------- |
| data.config | object | 配置项对象 |

### 示例请求

```bash
curl -X GET /api/config
```

### 示例响应

```json
{
  "code": 0,
  "msg": "获取配置成功",
  "data": {
    "config": {
      "encounter_groups_dir": "encounters",
      "other_setting": "some_value"
    }
  }
}
```

## 16. 保存配置项

### 基本信息

- **接口名称**: 保存配置项
- **请求地址**: `/api/config`
- **请求方法**: `PUT`
- **功能描述**: 保存配置到工作目录下的config.json文件

### 请求参数

| 参数名 | 类型   | 必填 | 说明       |
| ------ | ------ | ---- | ---------- |
| config | object | 是   | 配置项对象 |

### 请求示例

```bash
curl -X PUT /api/config \
  -H "Content-Type: application/json" \
  -d '{
    "config": {
      "encounter_groups_dir": "encounters",
      "other_setting": "new_value"
    }
  }'
```

### 示例响应

```json
{
  "code": 0,
  "msg": "保存配置成功",
  "data": null
}
```

## 17. 获取遭遇组列表

### 基本信息

- **接口名称**: 获取遭遇组列表
- **请求地址**: `/api/encounter-groups`
- **请求方法**: `GET`
- **功能描述**: 根据配置中的遭遇组目录，搜索所有png图片文件并返回名称列表

### 请求参数

无需传入参数

### 响应格式

| 字段                  | 类型  | 说明           |
| --------------------- | ----- | -------------- |
| data.encounter_groups | array | 遭遇组名称列表 |

### 示例请求

```bash
curl -X GET /api/encounter-groups
```

### 示例响应

```json
{
  "code": 0,
  "msg": "获取遭遇组列表成功",
  "data": {
    "encounter_groups": [
      "boss_encounter",
      "minion_encounter", 
      "special_encounter"
    ]
  }
}
```

# 工作空间相关接口

## 6. 获取文件树

### 基本信息

- **接口名称**: 获取文件树
- **请求地址**: `/api/file-tree`
- **请求方法**: `GET`
- **功能描述**: 获取工作目录的标准文件树结构，以工作空间目录为根节点，递归展示所有子目录和文件

### 请求参数

| 参数名         | 类型    | 必填 | 说明                        |
| -------------- | ------- | ---- | --------------------------- |
| include_hidden | boolean | 否   | 是否包含隐藏文件，默认false |

### 响应格式

返回标准的文件树结构，根节点为工作空间目录：

```typescript
interface TreeNode {
    label: string;           // 显示名称
    key: string;            // 唯一键值
    type: string;           // 类型标识
    path: string;           // 文件/目录完整路径
    children?: TreeNode[];  // 子节点数组（仅目录有此属性）
}
```

### 节点类型说明

| 类型      | 说明                          |
| --------- | ----------------------------- |
| workspace | 工作空间根节点                |
| directory | 目录节点                      |
| card      | 卡牌文件 (.card)              |
| image     | 图片文件 (.png, .jpg, .svg等) |
| config    | 配置文件 (.json, .yml等)      |
| text      | 文本文件 (.txt, .md等)        |
| style     | 样式文件 (.css等)             |
| data      | 数据文件 (.xml等)             |
| file      | 其他类型文件                  |

### 示例请求

```bash
curl -X GET "/api/file-tree?include_hidden=false"
```

### 示例响应

```json
{
  "code": 0,
  "msg": "获取文件树成功",
  "data": {
    "fileTree": {
      "label": "MyProject",
      "key": "workspace_1699123456000000",
      "type": "workspace",
      "path": "/Users/username/Documents/MyProject",
      "children": [
        {
          "label": "investigators",
          "key": "/Users/username/Documents/MyProject/investigators_1699123456000001",
          "type": "directory",
          "path": "/Users/username/Documents/MyProject/investigators",
          "children": [
            {
              "label": "Roland-Banks.card",
              "key": "/Users/username/Documents/MyProject/investigators/Roland-Banks.card_1699123456000002",
              "type": "card",
              "path": "/Users/username/Documents/MyProject/investigators/Roland-Banks.card"
            },
            {
              "label": "portraits",
              "key": "/Users/username/Documents/MyProject/investigators/portraits_1699123456000003",
              "type": "directory", 
              "path": "/Users/username/Documents/MyProject/investigators/portraits",
              "children": [
                {
                  "label": "roland.png",
                  "key": "/Users/username/Documents/MyProject/investigators/portraits/roland.png_1699123456000004",
                  "type": "image",
                  "path": "/Users/username/Documents/MyProject/investigators/portraits/roland.png"
                }
              ]
            }
          ]
        },
        {
          "label": "config.json",
          "key": "/Users/username/Documents/MyProject/config.json_1699123456000005",
          "type": "config",
          "path": "/Users/username/Documents/MyProject/config.json"
        },
        {
          "label": "README.md",
          "key": "/Users/username/Documents/MyProject/README.md_1699123456000006", 
          "type": "text",
          "path": "/Users/username/Documents/MyProject/README.md"
        }
      ]
    }
  }
}
```



### 注意事项

1. **配置依赖**: 需要先通过 `/api/config` 接口设置 `encounter_groups_dir` 配置项
2. **目录检查**: 系统会检查配置的目录是否存在
3. **文件过滤**: 只搜索 `.png` 扩展名的文件
4. **名称处理**: 返回的名称列表不包含文件扩展名
5. **排序**: 返回的列表按名称字母顺序排序


# 文件管理服务 API 文档

## 概述

文件管理服务是一个基于Flask的后端服务，为桌面应用程序提供文件和目录管理功能。服务运行在本地，通过HTTP接口与前端应用交互。

- **服务地址**: `http://localhost:5000`
- **协议**: HTTP
- **数据格式**: JSON
- **版本**: 2.0.0

## 统一响应格式

所有API接口均使用以下统一响应格式：

```json
{
  "code": 0,
  // 响应码，0表示成功，非0表示错误
  "msg": "操作结果描述",
  // 响应消息
  "data": {}
  // 响应数据，可为null、对象或数组
}
```

## 错误码说明

| 错误码范围 | 分类         | 说明                   |
| ---------- | ------------ | ---------------------- |
| 0          | 成功         | 操作成功               |
| 1001-1999  | 目录选择相关 | 目录选择操作相关错误   |
| 2001-2999  | 快速开始相关 | 最近目录管理相关错误   |
| 3001-3999  | 工作空间相关 | 工作空间操作相关错误   |
| 4001-4999  | 卡牌生成相关 | 卡牌生成和保存相关错误 |
| 5001-5999  | 文件内容相关 | 图片和文件信息相关错误 |
| 6001-6999  | 配置管理相关 | 配置项和遭遇组相关错误 |
| 9001-9999  | 系统错误     | HTTP状态码相关错误     |

### 详细错误码

| 错误码    | 说明                               |
| --------- | ---------------------------------- |
| 0         | 成功                               |
| 1001      | 目录选择操作正在进行中，请稍后再试 |
| 1002      | 操作超时，请重试                   |
| 1003      | 用户取消了选择                     |
| 1004      | 选择目录时出错                     |
| 1005      | 未能获取选择结果                   |
| 1006      | 服务器错误                         |
| 1007      | 创建工作空间失败                   |
| 2001-2008 | 最近目录管理相关错误               |
| 3001      | 请先选择或打开工作目录             |
| 3002-3020 | 工作空间操作相关错误               |
| 4001      | 请提供卡牌JSON数据                 |
| 4002      | 生成卡图失败                       |
| 4003      | 生成卡图失败（详细错误信息）       |
| 4004      | 请提供卡牌JSON数据和文件名         |
| 4005      | 保存卡图失败                       |
| 4006      | 保存卡图失败（详细错误信息）       |
| 5001      | 请提供图片路径                     |
| 5002      | 图片文件不存在或无法读取           |
| 5003      | 获取图片内容失败                   |
| 5004      | 请提供文件路径                     |
| 5005      | 文件不存在或无法访问               |
| 5006      | 获取文件信息失败                   |
| 6001      | 获取配置失败                       |
| 6002      | 请提供配置数据                     |
| 6003      | 保存配置失败                       |
| 6004      | 保存配置失败（详细错误信息）       |
| 6005      | 获取遭遇组列表失败                 |
| 9001      | 接口不存在 (404)                   |
| 9002      | 请求方法不支持 (405)               |
| 9003      | 服务器内部错误 (500)               |