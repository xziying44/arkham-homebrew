根据你提供的文档格式，我来编写TTS导出接口的文档：

# TTS导出接口文档

## 27. 导出TTS物品

### 基本信息

- **接口名称**: 导出TTS物品
- **请求地址**: `/api/export-tts`
- **请求方法**: `POST`
- **功能描述**: 将指定牌库导出为TTS（Tabletop Simulator）格式的JSON文件和封面图片，自动保存到TTS游戏目录

### 请求参数

| 参数名    | 类型   | 必填 | 说明                                           |
| --------- | ------ | ---- | ---------------------------------------------- |
| deck_name | string | 是   | 牌库名称（DeckBuilder文件夹中的文件名）        |
| face_url  | string | 是   | 正面图片URL（完整的HTTP/HTTPS地址）            |
| back_url  | string | 是   | 背面图片URL（完整的HTTP/HTTPS地址）            |

### 响应格式

**成功响应**
```json
{
  "code": 0,
  "msg": "TTS物品导出成功",
  "data": null
}
```

**失败响应**
```json
{
  "code": 11004,
  "msg": "TTS物品导出失败",
  "data": null
}
```

### 请求示例

```bash
curl -X POST /api/export-tts \
  -H "Content-Type: application/json" \
  -d '{
    "deck_name": "测试.deck",
    "face_url": "https://raw.githubusercontent.com/username/repo/main/images/front.jpg",
    "back_url": "https://raw.githubusercontent.com/username/repo/main/images/back.jpg"
  }'
```

```bash
curl -X POST /api/export-tts \
  -H "Content-Type: application/json" \
  -d '{
    "deck_name": "调查员牌组.deck",
    "face_url": "https://example.com/investigator-front.png",
    "back_url": "https://example.com/player-back.png"
  }'
```

### 示例响应

**导出成功**
```json
{
  "code": 0,
  "msg": "TTS物品导出成功",
  "data": null
}
```

**牌库文件不存在**
```json
{
  "code": 11004,
  "msg": "TTS物品导出失败",
  "data": null
}
```

**URL格式错误**
```json
{
  "code": 11002,
  "msg": "正面URL格式无效",
  "data": null
}
```

**缺少参数**
```json
{
  "code": 11001,
  "msg": "请提供牌库名称、正面URL和背面URL",
  "data": null
}
```

## 功能说明

### 导出内容

1. **TTS JSON文件**: 包含完整的TTS物品配置，支持卡牌脚本和标签
2. **封面图片**: 256x256像素的PNG格式封面，使用第一个有效对象的正面作为封面

### 保存路径

文件自动保存到以下目录：
```
我的文档/My Games/Tabletop Simulator/Saves/Saved Objects/阿卡姬制作/
```

如果目录不存在，系统会自动创建。

### 文件命名规则

- **JSON文件**: `{牌库名称}_{随机ID}.json`
- **封面文件**: `{牌库名称}_{随机ID}.png`

随机ID为8位UUID，确保文件名不重复。

### 支持的卡牌类型

| 类型     | 说明                                     | 标签设置      |
| -------- | ---------------------------------------- | ------------- |
| card     | 卡牌对象，包含完整脚本和GMNotes          | 根据类型设置  |
| image    | 图片文件，作为基础卡牌对象               | PlayerCard    |
| cardback | 卡牌背面，支持player和encounter类型      | PlayerCard    |

### 特殊功能

1. **调查员卡支持**: 自动检测调查员卡并设置横置属性
2. **脚本继承**: 背面卡牌的脚本会继承到正面（如果正面无脚本）
3. **标签自动设置**: 根据卡牌类型自动设置对应的TTS标签
4. **缩放自动调整**: 根据卡牌类型自动调整牌堆缩放比例

## 错误码说明

### TTS导出相关错误码 (11001-11099)

| 错误码 | 说明                                   |
| ------ | -------------------------------------- |
| 11001  | 请提供牌库名称、正面URL和背面URL       |
| 11002  | 正面URL格式无效                        |
| 11003  | 背面URL格式无效                        |
| 11004  | TTS物品导出失败                        |
| 11005  | 导出TTS物品失败（系统错误）            |

## 前置条件

1. **工作空间**: 必须先选择或打开工作目录
2. **牌库文件**: 指定的牌库文件必须存在于DeckBuilder目录中
3. **TTS转换器**: 需要tts_card_converter模块可用
4. **图片URL**: 提供的URL必须是有效的HTTP/HTTPS地址

## 使用流程

1. **准备牌库文件**
   - 在DeckBuilder目录中创建或选择牌库文件
   - 确保牌库包含有效的卡牌数据

2. **准备图片URL**
   - 上传正面和背面图片到图床
   - 获取可访问的直链地址

3. **调用导出接口**
   - 提供牌库名称和图片URL
   - 等待导出完成

4. **在TTS中使用**
   - 启动Tabletop Simulator
   - 在Objects → Saved Objects → 阿卡姬制作中找到导出的物品
   - 将物品拖拽到游戏桌面上使用

## 封面生成规则

封面图片按以下优先级选择：

1. **card类型**: 优先使用第一个card类型对象生成的卡图
2. **image类型**: 其次使用第一个image类型的图片文件
3. **cardback类型**: 最后使用卡背图片
4. **默认封面**: 如果没有任何有效对象，生成灰色默认封面

## TTS物品结构

导出的JSON文件包含以下关键结构：

```json
{
  "ObjectStates": [
    {
      "Name": "Deck",
      "Nickname": "牌库名称",
      "DeckIDs": [270000, 270001, ...],
      "CustomDeck": {
        "2700": {
          "FaceURL": "正面图片URL",
          "BackURL": "背面图片URL",
          "NumWidth": 10,
          "NumHeight": 7
        }
      },
      "ContainedObjects": [
        {
          "Name": "Card",
          "CardID": 270000,
          "Nickname": "卡牌名称",
          "GMNotes": "卡牌数据",
          "LuaScript": "脚本代码",
          "Tags": ["PlayerCard"]
        }
      ]
    }
  ]
}
```

## 注意事项

1. **网络连接**: TTS需要能够访问提供的图片URL
2. **图片尺寸**: 建议使用标准卡牌比例的图片以获得最佳效果
3. **文件大小**: 大型牌库可能生成较大的JSON文件
4. **TTS版本**: 确保使用兼容的Tabletop Simulator版本
5. **中文路径**: 系统自动处理中文路径和文件名
6. **权限要求**: 需要对TTS保存目录有写入权限

## 故障排除

### 常见问题

1. **牌库文件不存在**
   - 检查DeckBuilder目录是否存在
   - 确认牌库文件名称正确

2. **URL访问失败**
   - 验证URL是否可访问
   - 检查网络连接状态

3. **保存目录创建失败**
   - 确认用户文档目录存在
   - 检查磁盘空间和权限

4. **封面生成失败**
   - 检查牌库是否包含有效卡牌
   - 确认卡牌文件格式正确