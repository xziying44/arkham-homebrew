# 阿卡姆印牌姬用户指南（2025 版）

## 目录（6 大章节）

1. [快速开始（下载、首次运行、打开工作区）](#1-快速开始)
2. [界面总览（主页与工作区三栏布局）](#2-界面总览)
3. [基础功能（表单编辑、富文本、资源管理、单卡批量导出）](#3-基础功能15-核心能力)
4. [内容包管理（遭遇组、自动编号、ArkhamDBTTS-与-PNP-导出）](#4-内容包管理)
5. [高级功能（布局控制、TTS-脚本、图床、DeckBuilder）](#5-高级功能)
6. [常见问题（性能、打印、平台权限与网络）](#6-常见问题性能打印平台权限与网络)

---

## 1. 快速开始

### 1.1 获取与安装

仅包含 Windows 与 macOS 平台的运行说明（源码构建与 Android 不在本指南范围）。

- Windows（推荐）
  1. 前往 GitHub Releases 下载最新版发行包
  2. 解压到不含空格/特殊字符的路径
  3. 双击 `Arkham Card Maker.exe` 启动
  4. 首次运行若被 Defender 拦截：选择“更多信息”→“仍要运行”。
  
- macOS（arm64/x86_64）
  1. 下载与机器架构匹配的 `.dmg`
  2. 双击后拖拽到“应用程序”
  3. 首次运行：右键应用图标→“打开”，确认一次 Gatekeeper 提示。


### 1.2 首次启动与选择工作区

启动后进入“首页”并看到以下区域：
- 最近项目：显示 20 条内的历史工作区（由后端 QuickStart 维护）
- 选择目录：打开或新建工作区目录
- 语言切换：中/英界面即时切换
- 服务状态：后端 Flask 服务状态与版本

![截图：首页界面](screenshots/home-page.png)

选择工作区步骤：
1. 点击“选择目录”
2. 在对话框中选定或创建空目录
3. 确认后进入工作区主界面

![截图：选择工作区](screenshots/select-workspace.png)

说明（大项目扫描行为）：
- 文件树“结构快返 + 后台异步类型扫描”两段式完成。先秒级显示目录结构，再逐步标注 `card_type` 图标与可预览信息。
- 顶部会显示扫描进度（由 `/api/workspace/scan-progress/<scan_id>` 提供数据）。

### 1.3 创建你的第一张卡

1. 在左侧文件树，右键目标文件夹→新建文件→输入 `示例.card`
2. 选择文件后，中栏表单自动匹配卡牌类型并渲染字段。
3. 右侧实时预览卡面；可随时导出 PNG/JPG/PDF。

![截图：卡牌编辑表单与实时预览](screenshots/edit-card.png)

---

## 2. 界面总览

### 2.1 首页（HomePage）

- 快捷入口：选择目录、切换语言。
- 最近项目：点击快速进入；右键从列表移除

### 2.2 工作区（WorkspacePage）三栏布局

- 左栏：文件树面板
  - 快速操作：新建/重命名/删除/刷新
  - 搜索框：支持名称与类型筛选
  - 虚拟滚动：大项目流畅浏览（历史教训已采用虚拟列表实现）
  - 类型标识：`.card/.card.json` 显示卡牌类型图标
- 中栏：卡牌编辑器（表单驱动）
  - 动态字段：随卡牌类型切换字段
  - 字段校验：必填校验与数据类型限制
  - 富文本：支持 HTML 风格标记与图标占位
- 右栏：实时预览与导出
  - 缩放/适配窗口
  - 双面卡正反面切换

---

## 3. 基础功能（15+ 核心能力）

本节覆盖日常制卡的高频操作，确保从“能编辑”到“能导出”的全链路体验。

### 3.1 文件与目录

1. 新建目录：文件树右键→新建文件夹→重命名→回车。
2. 新建卡牌：右键→新建卡牌→输入文件名回车。
3. 重命名/删除：右键对应项→操作→确认。

命名建议：
```
工作区/
├─ 调查员/
├─ 支援/
├─ 事件/
├─ 技能/
└─ 剧本/
   ├─ 冒险一/
   └─ 冒险二/
   └─ 功能遭遇/
```

### 3.2 表单编辑

- 动态字段：来自前端 `cardTypeConfigs.ts`（20+ 类型）
- 字段类型：文本、数字、下拉、文件选择、富文本

### 3.3 富文本与图标

点击文本框的帮助按钮获得提示

示例：
```
<免费>当你不与任何敌人交战，且你所在地点的一个相邻地点没有准备状态的敌人时，消耗沃比：移动到那个地点。
```



![截图：富文本编辑与图标选择器](screenshots/rich-text-editing.png)

### 3.4 插画布局与文字边界（高级排版控制）

阿卡姆印牌姬提供了两个强大的高级排版工具，用于精确控制插图和文字区域。

#### 3.4.1 插画布局编辑器

**功能**：精确控制卡牌插图的缩放、裁剪、旋转和偏移。

**使用方法**：

1. 在卡牌编辑器中，找到"插图"字段
2. 点击`高级布局`按钮。
3. 在弹出的编辑器中调整参数：
   - **缩放 (Scale)**：0.5 - 2.0（1.0 为原始大小）
   - **裁剪 (Crop)**：上/下/左/右边距百分比（0-100%）
   - **旋转 (Rotation)**：-180° 到 180°
   - **翻转 (Flip)**：水平翻转 / 垂直翻转
   - **偏移 (Offset)**：X/Y 轴像素偏移
4. 实时预览效果
5. 点击`应用`保存配置。

![插画布局编辑器](screenshots/illustration-layout-editor.png)

**应用场景**：

- 调整插图焦点位置（如将人物居中）
- 裁剪不需要的边缘
- 旋转横向插图
- 为圆形挖空区域优化构图

#### 3.4.2 文字边界编辑器

**功能**：自定义卡牌文本区域的形状和位置（支持多边形区域）。

**使用方法**：

1. 在卡牌编辑器中，找到"卡牌文本"字段
2. 点击`编辑文字边界`按钮。
3. 在弹出的编辑器中：
   - **可视化编辑**：拖动控制点调整多边形形状
   - **数值输入**：精确输入坐标（像素单位）
   - **预设形状**：选择矩形 / 梯形 / 自定义
4. 预览文字排版效果
5. 点击`应用`保存。

![文字边界编辑器](screenshots/text-boundary-editor.png)

**应用场景**：

- 适配不规则模板（如地点卡的六边形文字区）
- 绕开插图中的关键元素
- 创建独特的排版效果

### 3.5 单卡导出（PNG/JPG/PDF）

快速导出：在编辑器下方点击`快速导出`。

高级导出：右键卡牌对象，点击`高级导出`。

选项说明：
- 格式：PNG（无损）/JPG（小体积）
- 尺寸：四种尺寸可选择，官方卡牌尺寸为61.5mm×88mm，根据自己的需求选择。
- 出血：0/2/3mm（打印用）

![截图：单卡导出设置](screenshots/export-settings.png)

### 3.6 批量导出

文件树多选（`Ctrl` / `Cmd`），右键`高级导出`→同一套参数→开始→查看进度通知。

### 3.7 遭遇组与拓展图标

**遭遇组设置**：在工作目录创建一个文件夹用于存放你的遭遇组图标，将你的遭遇组图片(透明的png图片)放到这个目录下，最好按遭遇组名称命名便于管理。然后在设置里的`遭遇组图标目录`选中这个文件夹，就可以在卡牌编辑器中设置遭遇组了。

**拓展包图标设置**：拓展图标用于右下角标识，在工作目录下放置一个透明图片，比例最好1:1，然后在设置里的`底标图标`中选中这个图片就可以全局生效你的拓展图标了。

**全局版权信息：**在表单底部填写版权文本，例如：`© 2025 DIY`；不建议太长的文本，支持中文。

![截图：遭遇组配置](screenshots/encounter-set-config.png)

### 3.8 收藏与临时工作区

- 收藏：文件树右键→添加到收藏；常用/在修卡牌置顶显示
- 临时工作区：将你当前正在工作的卡牌文件，拖入到下方的临时工作区中，可以跨文件夹快速访问这些对象。

![截图：收藏夹与临时工作区](screenshots/favorite-cards.png)

### 3.9 双面卡、调查员小卡与定制卡绑定

- 调查员小卡：在`TTS 脚本`绑定对应小卡。
- 定制卡：在`TTS 脚本`绑定定制卡，ArkhamDB/TTS 导出自动合并升级选项

![截图：TTS 配置面板（小卡/定制）](screenshots/bind-mini-card.png)

### 3.10 定制卡编辑

**定制卡编辑提示**：

- 每行一个定制选项

- 使用 `<upg>` 或 `<升级>` 标记未选择项（会自动计算 XP 消耗）

- 示例：

  ```
  <升级>额外弹药 (+2 弹药)
  <升级>快速装填 (快速)
  <升级>穿甲弹 (+1 伤害)
  ```

![截图：定制卡编辑](screenshots/bind-customizable-card.png)

---

## 4. 内容包管理

内容包（Content Package）是批量管理剧本或战役卡牌的高效方式。通过内容包，您可以：
- 批量导出所有卡牌图片
- 一键生成 TTS 模组
- 导出到 arkham.build 在线卡组构建器
- 生成 PNP 打印文件

### 4.1 创建内容包

#### 方法 1：从工作区创建
1. 在导航栏点击`内容包管理`。
2. 点击`新建内容包`。
3. 填写内容包信息：
   - **包名称**：如"午夜面具战役"
   - **作者**：您的名字
   - **版本**：如 1.0
   - **描述**：简要说明内容
4. 选择要包含的卡牌文件（从文件树拖拽或多选）
5. 保存为 `.pack` 文件

![创建内容包](screenshots/create-content-package.png)

### **4.2 添加与管理卡牌**

当您打开一个已存在的内容包进行编辑时，可以通过“卡牌管理”界面为其动态添加更多卡牌。

1. **打开内容包**：首先，在 **「内容包管理」** 界面加载并打开您想要编辑的内容包。
2. **进入卡牌管理**：切换到 **「卡牌管理」** 视图，此时界面会显示当前内容包中已包含的卡牌。
3. **添加新卡牌**：点击 **「添加卡牌」** 按钮，会弹出文件选择器。
   - 支持**多选文件**或**直接选择整个文件夹**，文件夹内的所有卡牌都将被添加。
4. **完成添加**：选择完毕后，新的卡牌会被添加到当前正在编辑的内容包中。记得在完成所有修改后保存您的内容包。

![添加卡牌](screenshots/add-card-content-package.png)

### 4.3 上传图床

为了在 TTS 中使用自定义卡牌，需要将图片上传到图床获取公网 URL。

#### 推荐图床：Cloudinary
1. 注册 Cloudinary 账号（免费额度足够个人使用）
   - 前往：https://cloudinary.com/users/register/free
   - 注册并登录
2. 在应用中进入"设置" → "图床配置"
3. 填写 Cloudinary 配置：
   - **Cloud Name**：在 Cloudinary 控制台首页找到
   - **API Key** 和 **API Secret**：在"Settings" → "API Keys"中获取
   - **Upload Preset**（可选）：用于指定上传文件夹
4. 保存配置

![Cloudinary 配置1](screenshots/cloudinary-config-1.png)

![Cloudinary 配置2](screenshots/cloudinary-config-2.png)

#### 上传图片
1. 在"内容包管理"页面，打开已创建的内容包
2. 点击`上传到图床`按钮。
3. 选择要上传的卡牌（默认全选）
4. 点击`开始上传`。
5. 上传完成后，每张卡会获得一个公网 URL

**上传提示**：
- 首次上传可能需要几分钟（视卡牌数量和网络速度）
- 上传失败的卡牌会显示红色标记，可单独重试
- 上传后的 URL 会自动保存到卡牌配置中

![上传图床](screenshots/upload-to-image-host.png)

### 4.3 自动编号

为剧本卡牌自动分配编号，便于管理和打印。

#### 编号规则
1. 打开内容包
2. 点击`生成编号方案`。
3. 配置编号规则：
   - **起始编号**：如 1 或 100
   - **分组方式**：按遭遇组 / 按卡牌类型
4. 点击`生成`预览编号结果。
5. 确认无误后，点击`应用编号`。

![自动编号](screenshots/auto-numbering.png)

**编号用途**：
- 在 TTS 中按编号排序
- 打印时便于整理
- 导出到 ArkhamDB 时自动填充

### 4.4 TTS 导出

将内容包导出为 Tabletop Simulator 可用的 `.json` 文件。

#### 导出步骤
1. 确保所有卡牌已上传图床（或提供了图片 URL）
2. 在内容包页面点击`导出 TTS`。
3. 配置 TTS 导出选项：
   - **盒子名称**：在 TTS 中显示的容器名
   - **自动分组**：按卡牌类型自动分成多个牌堆
   - **包含脚本**：导出 Lua 脚本（用于特殊功能）
4. 点击`导出`，生成 `.json` 文件。

#### 导入到 TTS
1. 将导出的 `.json` 文件复制到(Windows会自动复制到此地址)：
   - Windows: `文档\My Games\Tabletop Simulator\Saves\Saved Objects`
   - macOS: `~/Documents/My Games/Tabletop Simulator/Saves/Saved Objects`
2. 打开 Tabletop Simulator
3. 点击顶部菜单 "Objects" → "Saved Objects"
4. 在 TTS 中刷新列表，即可看到您的自定义内容包

![TTS 导出](screenshots/tts-export.png)

**TTS 导出注意事项**：
- 图片 URL 必须是公网可访问的 HTTPS 地址
- 双面卡会自动处理正反面

### 4.5 arkham.build 导出

arkham.build 是一个在线卡组构建器，导出后可在线分享您的自定义卡牌。

#### 导出步骤
1. 打开内容包
2. 点击`导出到 arkham.build`。
3. 配置导出选项：
   - **包含插图 URL**：勾选后会包含 Cloudinary 图片链接
   - **兼容模式**：与官方卡牌数据格式兼容
4. 导出 JSON 文件

#### 导入到 arkham.build
1. 前往 https://arkham.build
2. 点击**设置**→**玩家自制内容**→**从文件导入**，选择导出的JSON文件（一般位于内容包目录下以`_arkhambuild.json`结尾）。
4. 您的自定义卡牌即可在线使用

![arkham.build 导出](screenshots/arkhamdb-export.png)

### 4.6 PNP 导出

PNP（Print and Play）导出功能可生成适合打印的 PDF 文件，每页包含多张卡牌。

#### 导出步骤
1. 打开内容包
2. 点击`导出 PNP`。
3. 配置打印选项：
   - **纸张尺寸**：A4 / Letter / A3
   - **每页卡牌数**：9 张（3×3）/ 8 张（2×4）
   - **出血标记**：显示裁切线
   - **背面处理**：自动生成对应的背面页
4. 点击`导出`，生成 PDF。

#### 打印指南
1. 使用彩色打印机（推荐激光打印机）
2. 选择"双面打印"（如果打印机支持）
3. 使用 200g-300g 卡纸
4. 按裁切线裁剪卡牌
5. 可选：套上卡套（61×88mm 标准卡套）

![PNP 导出](screenshots/pnp-export.png)

---

## 5. 高级功能

### 5.1 TTS 脚本配置

TTS 脚本（Lua Script）为卡牌添加交互功能，如自动计算、按钮操作等。

#### 5.1.1 入场标记配置

为卡牌设置进场时的标记（如线索、资源、生命值等）。

**配置路径**：
1. 打开卡牌编辑器
2. 展开"TTS 配置"区域
3. 找到"入场标记"设置
4. 添加标记：
   - **类型**：线索 / 资源 / 伤害 / 恐惧
   - **数量**：固定值 或 表达式（如 `1[per_investigator]`）
   - **颜色**：标记的颜色
5. 保存

**示例配置**：
```json
{
  "id": "9286599D",
  "type": "Asset",
  "traits": "道具. 武器. 近战.",
  "class": "Mystic",
  "cost": 3,
  "uses": [
    {
      "count": 3,
      "type": "Charge",
      "token": "resource"
    }
  ]
}
```

![入场标记配置](screenshots/spawn-markers-config.png)

#### 5.1.2 封印脚本配置

为卡牌添加封印混乱标记的能力（如"封印混乱袋中的 1 个骷髅标记"）。

**配置路径**：
1. 打开卡牌编辑器（支持封印功能的卡牌，如"保护符"）
2. 展开"TTS 配置" → "封印脚本"
3. 勾选"启用封印脚本"
4. 配置封印选项：
   - **允许封印的标记类型**：多选（骷髅、异教徒、石板等）
   - **最大封印数量**：如 1（留空表示无限制）
   - **允许所有标记**：勾选后可封印任意标记（高级用法）
5. 保存

**封印标记选项**：
- Elder Sign（旧印）
- Auto-fail（自动失败）
- Skull（骷髅）
- Cultist（异教徒）
- Tablet（石板）
- Elder Thing（古神）
- Bless（祝福）
- Curse（诅咒）
- Frost（寒霜）

![封印脚本配置](screenshots/seal-script-config.png)

**TTS 中的封印操作**：
- 右键点击卡牌 → "封印标记"
- 选择要封印的标记
- 释放标记：右键 → "释放标记"
- 结算标记：右键 → "结算标记"（适用于祝福/诅咒等）

### 5.2 牌库选项配置 (DeckOption)

牌库选项用于创建灵活的卡组构建规则，适用于调查员、剧本或特殊能力。

#### 5.2.1 无选择机制

最简单的牌库选项，直接指定可用卡牌。

**配置示例**：

![无选择机制](screenshots/deck-option-simple.png)

#### 5.2.2 选择职阶或特性

允许玩家在多个职阶或卡牌特性中选择。

**使用场景**：
- 多职阶调查员（如罗拉·海耶斯）
- 剧本奖励卡池

![选择职阶](screenshots/deck-option-faction-select.png)

#### 5.2.3 高级选择机制

支持复杂的条件组合，如"选择 3 个特性，每个特性最多 2 张"。

**高级选项字段**：
- `trait_select`：特性多选
- `option_select`：多个子选项的组合（嵌套规则）
- `atleast`：至少包含指定条件
- `not`：排除条件

#### 牌库选项编辑器

在"牌库制作"页面，可使用可视化编辑器配置牌库选项：
1. 点击`添加牌库选项`。
2. 选择选项类型（无选择/职阶选择/特性选择/高级）
3. 填写配置表单
4. 预览 JSON 输出
5. 保存

### 5.3 Lama 出血功能

Lama 出血是一种基于 AI 的图片扩展技术，可自动为卡牌插图添加出血边（用于打印裁切）。

#### 配置 Lama 服务

Lama 的安装文档参考这里：

[arkham-homebrew/export_helper/INSTALL_zh-CN.md at master · xziying44/arkham-homebrew](https://github.com/xziying44/arkham-homebrew/blob/master/export_helper/INSTALL_zh-CN.md)

**注意事项**：
- Lama 处理需要几秒钟（视图片大小和网络速度）
- 首次使用可能需要下载 AI 模型（约 200MB）
- 处理失败时会自动回退到镜像出血

---

## 6. 常见问题

### 6.1 文件扫描慢怎么办？

**问题描述**：打开包含 1000+ 文件的大型工作区时，文件树加载缓慢。

**优化方案**：

#### 方案 1：渐进式加载（应用内置）
应用已自动采用渐进式加载策略：
1. **第一阶段**（<1秒）：快速返回目录结构，只显示文件夹和文件名
2. **第二阶段**（后台）：异步扫描卡牌类型，实时更新图标

**您无需手动操作**，但可以在设置中调整：
- 进入"设置" → "性能优化"
- 调整"扫描批次大小"（默认 200）
- 勾选"仅扫描可见文件"（推荐）

#### 方案 2：文件组织优化
良好的文件组织可显著提升性能：
```
推荐结构：
工作区/
├── 调查员/            (< 50 files)
├── 玩家卡/            (< 200 files per subfolder)
│   ├── 守护者/
│   ├── 寻求者/
│   └── ...
└── 剧本/              (按剧本分文件夹)
    ├── 午夜面具/      (< 100 files)
    └── 食尸鬼之夜/

避免：
工作区/
└── 所有卡牌/          (1000+ files，扫描慢)
```

#### 方案 3：使用缓存
应用会自动缓存卡牌类型信息：
- 缓存文件：`.cache/card_types.json`
- 仅在文件修改时重新扫描
- 可手动刷新：右键文件树 → "刷新缓存"

### 6.2 虚拟列表优化说明

**问题描述**：文件树显示大量文件时滚动卡顿。

**解决方案**：应用已集成虚拟滚动技术（vue-virt-list），您可以流畅浏览任意数量的文件。

**工作原理**：
- 只渲染屏幕可见的文件节点（约 20-30 个）
- 滚动时动态更新可见区域
- 内存占用恒定，性能稳定

**注意事项**：
- 搜索过滤后，虚拟列表会自动重建索引
- 展开/折叠大型文件夹可能有短暂延迟（正常现象）

#### 6.3.3 排版技巧

**技巧 1：插图焦点优化**
对于人物肖像插图：
1. 使用"缩放"放大到 1.3-1.5
2. 使用"裁剪"去除边缘
3. 使用"偏移"将人物脸部移至卡牌上方

**技巧 2：文字与插图平衡**
如果文字区域与插图重叠：
1. 使用"文字边界编辑器"缩小文字区域
2. 或使用"插画布局编辑器"缩小插图
3. 平衡美观与可读性

**技巧 3：多语言适配**
中文文字比英文占据更多空间：
- 可为中文卡适当缩小字号（在"设置"中调整）
- 或调整文字边界以提供更多空间

### 6.4 无法启动应用？

**可能原因 1：杀毒软件拦截**
- 将应用添加到杀毒软件白名单
- 或临时关闭实时保护后重试

**可能原因 2：缺少运行库**（Windows）
- 安装 Visual C++ Redistributable：https://aka.ms/vs/17/release/vc_redist.x64.exe

**可能原因 3：端口冲突**
- 应用默认使用 5000 端口，如果被占用，可在启动时指定其他端口：
  ```
  Arkham Card Maker.exe --port 5001
  ```

### 6.5 导出的图片模糊？

**解决方案**：
1. 在导出设置中，将"DPI"设置为 300（打印级别）
2. 选择"PNG"格式（无损）
3. 确保插图原图分辨率足够（推荐 1500×2100 像素）
4. 避免过度缩放插图（缩放 > 2.0 会导致模糊）

### 6.6 TTS 导入后卡牌显示错误？

**常见问题**：
- **图片不显示**：检查图片 URL 是否为 HTTPS，且公网可访问
- **卡牌尺寸错误**：检查是否选择了正确的卡牌类型（标准/横向/调查员）
- **背面不显示**：确保卡牌配置中勾选了"独立背面"

**调试步骤**：
1. 在浏览器中打开图片 URL，确认可访问
2. 检查 TTS 日志（`%USERPROFILE%\Documents\My Games\Tabletop Simulator\Logs\`）
3. 尝试重新导出并导入

### 6.7 如何备份工作区？

**方法 1：手动备份**
直接复制整个工作区文件夹到其他位置（如云盘、移动硬盘）。

**方法 2：使用版本控制**（推荐开发者）
1. 在工作区目录初始化 Git 仓库：
   ```bash
   cd 工作区目录
   git init
   git add .
   git commit -m "初始备份"
   ```
2. 每次重要修改后提交：
   ```bash
   git add .
   git commit -m "更新卡牌"
   ```

**建议备份频率**：
- 每完成一张重要卡牌后
- 每完成一个剧本后
- 每周至少备份一次

### 6.8 如何获取更多帮助？

**官方资源**：
- GitHub 项目页：[github.com/xziying44/arkham-homebrew](https://github.com/xziying44/arkham-homebrew)
- 问题反馈：[xziying44/arkham-homebrew](https://github.com/xziying44/arkham-homebrew/issues)
- 更新日志：查看"关于"页面

**社区资源**：

- QQ 交流群：441317092
- Discord 频道：[Arkham Card Maker](https://discord.com/channels/225349059689447425/1409199111994867903)

---

**感谢您使用阿卡姆印牌姬！祝您创作愉快！**

如果你喜欢本项目的话，可以在GitHub点一个星星⭐。

如有任何问题或建议，欢迎在 GitHub 提交 Issue 或加入社区交流。
